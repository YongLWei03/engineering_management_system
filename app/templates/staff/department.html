{% extends "base.html" %}

{% block styles %}
{{ super() }}
<link href="//cdn.bootcss.com/zTree.v3/3.5.24/css/zTreeStyle/zTreeStyle.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid" style="height:45em;background-color:white">
    <div>
        <ul id="department_tree" class="ztree"></ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="//cdn.bootcss.com/zTree.v3/3.5.24/js/jquery.ztree.all.min.js"></script>
<SCRIPT LANGUAGE="JavaScript">
    var zTreeObj;
    // zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）
    var setting = {
        treeId: "#department_tree",
        treeObj: zTreeObj,
        edit:{
            enable: true,
			showRemoveBtn: true,
			showRenameBtn: true,
			removeTitle: "删除",
			renameTitle: "编辑"
        },
		data: {
			simpleData: {
            enable: true,
            idKey: "id",
            pIdKey: "pId",
            rootPId: 0
			}
		},
        view:{  
			addHoverDom:addHoverDom,  
			removeHoverDom:removeHoverDom,  
			selectedMulti:false  
		}, 
    };
    var newCount = 1;
	function addHoverDom(treeId, treeNode) {
		var sObj = $("#" + treeNode.tId + "_span");
		if (treeNode.editNameFlag || $("#addBtn_"+treeNode.tId).length>0) return;
		var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
			+ "' title='add node' onfocus='this.blur();'></span>";
		sObj.after(addStr);
		var btn = $("#addBtn_"+treeNode.tId);
		if (btn) btn.bind("click", function(){
			var zTree = $.fn.zTree.getZTreeObj("treeDemo");
			var nodeId = 100 + newCount;
			var name = "新分类" + (newCount++);
			addTreeNode(treeNode,name,zTree);
			return false;
		});
	};
	function removeHoverDom(treeId, treeNode) {
		$("#addBtn_"+treeNode.tId).unbind().remove();
	};
    $(document).ready(function(){
        $.ajax({
            type: "GET",
            dataType: "json",
            url: "/staff/department/get_tree_json/",
            success: function(departments){
                zTreeObj = $.fn.zTree.init($("#department_tree"), setting, departments);
            }
        })
    });
    </SCRIPT>
{% endblock %}
