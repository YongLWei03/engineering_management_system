{% extends "base.html" %}

{% block styles %}
{{ super() }}
<link href="//cdn.bootcss.com/zTree.v3/3.5.24/css/zTreeStyle/zTreeStyle.min.css" rel="stylesheet">
<link href="{{ url_for('static', filename='css/department.css') }}" rel="stylesheet"> 
{% endblock %}

{% block content %}
<div class="container-fluid" style="height:45em;background-color:white">
    <div>
        <ul id="department_tree" class="ztree"></ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="//cdn.bootcss.com/zTree.v3/3.5.24/js/jquery.ztree.all.min.js"></script>
<SCRIPT LANGUAGE="JavaScript">
    var zTreeObj;
    var setting = {
        edit:{
            enable: true,
	    showRemoveBtn: true,
	    showRenameBtn: true,
	    removeTitle: "删除",
	    renameTitle: "编辑"
        },
	data: {
	    simpleData: {
	    	enable: true,
	    }
	},
        view:{  
	    addHoverDom:addHoverDom,  
	    removeHoverDom:removeHoverDom,  
        }, 
    };
    function addHoverDom(treeId, treeNode) {
        var aObj = $("#" + treeNode.tId + "_a");
        if ($("#diyBtn_"+treeNode.id).length>0) return;
        var editStr = "<span class='button add' id='diyBtn_space_" +treeNode.id+ "' > </span>"
    	+ "<button type='button' class='diyBtn1 hidden' id='diyBtn_" + treeNode.id
    	+ "' title='"+treeNode.name+"' onfocus='this.blur();'></button>";
        aObj.append(editStr);
        var btn = $("#diyBtn_"+treeNode.id);
        if (btn) btn.bind("click", function(){
            alert("aaa");
	});
    };
    function removeHoverDom(treeId, treeNode) {
        $("#diyBtn_"+treeNode.id).unbind().remove();
        $("#diyBtn_space_" +treeNode.id).unbind().remove();
    };
    $(document).ready(function(){
        $.ajax({
            type: "GET",
            dataType: "json",
            url: "/staff/department/get_tree_json/",
            success: function(departments){
                zTreeObj = $.fn.zTree.init($("#department_tree"), setting, departments);
            }
        })
    });
    </SCRIPT>
{% endblock %}
